<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Xamplore – Secure Exam</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Tailwind -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<!-- Lucide Icons -->
<script src="https://unpkg.com/lucide@latest"></script>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&family=Montserrat:wght@700;900&display=swap" rel="stylesheet">

<style>
* {
  user-select: none;
  -webkit-user-select: none;
}
body {
  font-family: 'Poppins', sans-serif;
}
.brand {
  font-family: 'Montserrat', sans-serif;
}
</style>
</head>

<body class="bg-white text-gray-800 min-h-screen">

<!-- NAVBAR -->
<nav class="border-b shadow-sm">
  <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
    <div class="flex items-center gap-2 brand text-2xl font-extrabold text-emerald-600">
      <i data-lucide="graduation-cap"></i>
      Xamplore
    </div>

    <div class="hidden md:flex gap-8 font-semibold">
      <button onclick="showSection('home')">Home</button>
      <button onclick="showSection('test')">Test</button>
      <button onclick="showSection('about')">About</button>
    </div>

    <button class="md:hidden" onclick="toggleMenu()">
      <i data-lucide="menu"></i>
    </button>
  </div>

  <div id="mobileMenu" class="hidden md:hidden px-6 pb-4 space-y-3 font-semibold">
    <button class="block" onclick="showSection('home')">Home</button>
    <button class="block" onclick="showSection('test')">Test</button>
    <button class="block" onclick="showSection('about')">About</button>
  </div>
</nav>

<!-- HOME -->
<section id="home" class="py-20 text-center">
  <h1 class="text-5xl font-extrabold brand text-emerald-600">Smarter Exams</h1>
  <p class="mt-4 text-xl font-semibold">Built for SRCAS Students</p>
  <p class="mt-6 max-w-xl mx-auto text-gray-600">
    Xamplore ensures integrity, focus, and fairness in online examinations with secure exam flow.
  </p>
</section>

<!-- TEST -->
<section id="test" class="hidden py-16">
  <div class="max-w-xl mx-auto bg-white p-6 rounded-xl shadow-xl">

    <!-- LOGIN -->
    <div id="login">
      <h2 class="text-2xl font-bold mb-4 text-emerald-600">Exam Login</h2>
      <input id="nameInput" class="w-full p-2 mb-3 border rounded" placeholder="Your Name">
      <select id="patternSelect" class="w-full p-2 mb-3 border rounded">
        <option value="">Select Pattern</option>
        <option value="A">Pattern A</option>
        <option value="B">Pattern B</option>
        <option value="C">Pattern C</option>
      </select>
      <input id="passwordInput" type="password" class="w-full p-2 mb-4 border rounded" placeholder="Pattern Password">
      <button onclick="verifyLogin()" class="w-full bg-emerald-600 text-white p-2 rounded font-semibold">
        Continue
      </button>
    </div>

    <!-- RULES -->
    <div id="rules" class="hidden">
      <h2 class="text-xl font-bold text-emerald-600 mb-3">Rules & Regulations</h2>
      <ul class="list-disc pl-5 text-sm space-y-2">
        <li>No tab switching</li>
        <li>No exiting fullscreen</li>
        <li>No screenshots or copy</li>
        <li>Violation ends test immediately</li>
      </ul>
      <button onclick="startExam()" class="mt-4 w-full bg-emerald-600 text-white p-2 rounded">
        I Agree & Start Exam
      </button>
    </div>

    <!-- TEST -->
    <div id="exam" class="hidden">
      <div id="questionBox"></div>
      <button onclick="nextQuestion()" class="mt-4 w-full bg-emerald-600 text-white p-2 rounded">
        Next
      </button>
    </div>

    <!-- FAILED -->
    <div id="failed" class="hidden text-center">
      <h2 class="text-xl font-bold text-red-600">Test Failed</h2>
      <p class="text-sm mt-2">Enter second chance password</p>
      <input id="secondPass" class="w-full p-2 mt-3 border rounded" placeholder="Second Chance Password">
      <button onclick="secondChance()" class="mt-3 w-full bg-emerald-600 text-white p-2 rounded">
        Retry Exam
      </button>
    </div>

    <!-- RESULT -->
    <div id="result" class="hidden text-center">
      <h2 class="text-2xl font-bold text-emerald-600">Test Completed</h2>
      <p id="resultText" class="mt-3"></p>
      <button onclick="downloadPDF()" class="mt-4 bg-emerald-600 text-white p-2 rounded">
        Download PDF
      </button>
    </div>

  </div>
</section>

<!-- ABOUT -->
<section id="about" class="hidden py-20 text-center">
  <h2 class="text-3xl font-bold text-emerald-600">About Xamplore</h2>
  <p class="mt-4 max-w-xl mx-auto text-gray-600">
    Xamplore is a secure online examination platform designed to prevent malpractice and ensure fairness.
  </p>
</section>

<script>
lucide.createIcons();

/* NAV */
function toggleMenu() {
  mobileMenu.classList.toggle("hidden");
}
function showSection(id) {
  ["home","test","about"].forEach(s => document.getElementById(s).classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
  mobileMenu.classList.add("hidden");
}

/* DATA */
const PASSWORDS = { A:"alpha123", B:"beta123", C:"gamma123" };
const SECOND_PASS = "choice2ellen";

const QUESTION_BANK = {
  A:[
    {q:"Which keyword stores constants in JavaScript?",options:["var","let","const","static"],answer:"const"},
    {q:"Which HTML tag is used for navigation?",options:["div","nav","header","section"],answer:"nav"}
  ],
  B:[
    {q:"Which CSS unit is relative to viewport width?",options:["px","em","vh","vw"],answer:"vw"},
    {q:"Which function shows an alert box?",options:["prompt()","alert()","confirm()","log()"],answer:"alert()"}
  ],
  C:[
    {q:"Which method selects an element by ID?",options:["queryAll","getElement","getElementById","selectId"],answer:"getElementById"},
    {q:"Which tag runs JavaScript?",options:["js","script","code","javascript"],answer:"script"}
  ]
};

/* STATE */
let studentName, pattern, questions, index=0, answers=[], examStarted=false;

/* LOGIN */
function verifyLogin() {
  studentName = nameInput.value.trim();
  pattern = patternSelect.value;
  if (!studentName || !pattern || PASSWORDS[pattern] !== passwordInput.value)
    return alert("Invalid details");
  login.classList.add("hidden");
  rules.classList.remove("hidden");
}

/* START */
function startExam() {
  rules.classList.add("hidden");
  exam.classList.remove("hidden");
  examStarted = true;
  index = 0;
  answers = [];
  questions = [...QUESTION_BANK[pattern]].sort(()=>Math.random()-0.5);
  document.documentElement.requestFullscreen().catch(()=>{});
  renderQuestion();
}

/* SECURITY */
function failTest(reason){
  examStarted=false;
  document.exitFullscreen().catch(()=>{});
  exam.classList.add("hidden");
  failed.classList.remove("hidden");
}

document.addEventListener("visibilitychange",()=>examStarted&&document.hidden&&failTest());
window.addEventListener("blur",()=>examStarted&&failTest());
document.addEventListener("fullscreenchange",()=>examStarted&&!document.fullscreenElement&&failTest());

/* QUESTIONS */
function renderQuestion(){
  const q = questions[index];
  questionBox.innerHTML =
    `<p class="font-semibold mb-3">${q.q}</p>` +
    q.options.map(o=>`
      <label class="block mb-2">
        <input type="radio" name="ans" value="${o}"> ${o}
      </label>`).join("");
}

function nextQuestion(){
  const sel=document.querySelector("input[name='ans']:checked");
  if(!sel) return alert("Select an option");
  answers.push(sel.value);
  index++;
  index>=questions.length?showResult():renderQuestion();
}

/* SECOND CHANCE */
function secondChance(){
  if(secondPass.value!==SECOND_PASS) return alert("Wrong password");
  location.reload();
}

/* RESULT */
function showResult(){
  examStarted=false;
  document.exitFullscreen().catch(()=>{});
  exam.classList.add("hidden");
  result.classList.remove("hidden");
  const score = answers.filter((a,i)=>a===questions[i].answer).length;
  resultText.textContent = `${studentName} — Score ${score}/${questions.length}`;
}

/* PDF */
function downloadPDF(){
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF();
  let y=10;
  pdf.text(`Name: ${studentName}`,10,y); y+=10;
  questions.forEach((q,i)=>{
    pdf.text(`Q${i+1}: ${q.q}`,10,y); y+=6;
    pdf.text(`Your: ${answers[i]}`,10,y); y+=6;
    pdf.text(`Correct: ${q.answer}`,10,y); y+=8;
  });
  pdf.save("Xamplore_Result.pdf");
}
</script>

</body>
</html>
